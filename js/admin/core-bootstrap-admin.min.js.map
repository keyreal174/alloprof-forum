{"version":3,"sources":["webpack://core_bootstrapAdmin/webpack/bootstrap","webpack://core_bootstrapAdmin/delegated ./src/scripts/application.ts from dll-reference lib_core_admin","webpack://core_bootstrapAdmin/delegated ./src/scripts/utility.ts from dll-reference lib_core_admin","webpack://core_bootstrapAdmin/external \"lib_core_admin\"","webpack://core_bootstrapAdmin/delegated ./node_modules/react/index.js from dll-reference lib_core_admin","webpack://core_bootstrapAdmin/delegated ./node_modules/react-router-dom/es/index.js from dll-reference lib_core_admin","webpack://core_bootstrapAdmin/delegated ./src/scripts/apiv2.ts from dll-reference lib_core_admin","webpack://core_bootstrapAdmin/delegated ./src/scripts/gdn.ts from dll-reference lib_core_admin","webpack://core_bootstrapAdmin/delegated ./node_modules/react-dom/index.js from dll-reference lib_core_admin","webpack://core_bootstrapAdmin/delegated ./src/scripts/Main/NotFoundPage.tsx from dll-reference lib_core_admin","webpack://core_bootstrapAdmin/./src/scripts/legacy/atwho.ts","webpack://core_bootstrapAdmin/./src/scripts/Main/App.tsx","webpack://core_bootstrapAdmin/./src/scripts/legacy/index.ts","webpack://core_bootstrapAdmin/./src/scripts/bootstrap/bootstrap.ts","webpack://core_bootstrapAdmin/./src/scripts/internal.tsx"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","default","object","property","prototype","hasOwnProperty","p","s","t","e","lib_core_admin","rawMatch","a","u","setPrototypeOf","__proto__","Array","this","constructor","create","assign","arguments","length","f","_super","App","__extends","render","routes","applicationfrom_dll_reference_lib_core_admin","getRoutes","map","route","reactfrom_dll_reference_lib_core_admin_default","createElement","type","__assign","key","props","path","exact","push","esfrom_dll_reference_lib_core_admin","Route","component","NotFoundPagefrom_dll_reference_lib_core_admin","BrowserRouter","basename","getMeta","Switch","PureComponent","atCache","atEmpty","minCharacters","maxSuggestions","serverLimit","emojiData","emojis","emoji","emojiFormat","format","emojiAssetPath","assetPath","emojiList","entries","_a","_b","__read","index","emojiImageUrl","parts","split","filename","ext","emojiTemplate","replace","matchAtMention","flag","subtext","shouldStartWithSpace","match","utilityfrom_dll_reference_lib_core_admin","matchFakeEmoji","RegExp","exec","initializeAtComplete","editorElement","iframe","iframeWindow","contentWindow","$","atwho","at","tpl","limit","callbacks","remote_filter","query","callback","shouldContinueFiltering","filterString","slice","isQueryEmpty","getJSON","formatUrl","q","data","isArray","forEach","result","before_insert","$li","username","requiresQuotation","test","hasQuotation","insert","highlighter","li","regexp","str","$1","$2","$3","$4","matcher","cWindow","insert_tpl","tplEval","log","on","event","offset","context","suggestionElement","view","$el","$inputor","lineHeight","parseInt","css","iframeOffset","leftCoordinate","left","topCoordinate","top","selectHeight","text","fontMirror","font","fontWidth","width","each","element","outerHeight","height","windowHeight","window","scrollPosition","scrollTop","newOffset","fn","onReady","onContent","gdn","atCompleteInit","debug","gdnfrom_dll_reference_lib_core_admin","apiv2","apiv2from_dll_reference_lib_core_admin","parent","componentExists","addComponent","Main_App","nodes","querySelectorAll","node","getAttribute","Component","getComponent","react_domfrom_dll_reference_lib_core_admin_default","logError","target","_executeReady","then","contentEvent","CustomEvent","bubbles","cancelable","document","dispatchEvent","catch","error"],"mappings":"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","file":"admin/core-bootstrap-admin.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/js/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n","module.exports = (__webpack_require__(2))(10);","module.exports = (__webpack_require__(2))(38);","module.exports = lib_core_admin;","module.exports = (__webpack_require__(2))(1);","module.exports = (__webpack_require__(2))(99);","module.exports = (__webpack_require__(2))(135);","module.exports = (__webpack_require__(2))(7);","module.exports = (__webpack_require__(2))(110);","module.exports = (__webpack_require__(2))(95);","/**\n * At-who setup for legacy @mentions.\n *\n * @author Adam Charron <adam.c@vanillaforums.com>\n * @copyright 2009-2018 Vanilla Forums Inc.\n * @license GPLv2\n */\n\nimport { formatUrl, getMeta } from \"@core/application\";\nimport { log, matchAtMention as _matchAtMention } from \"@core/utility\";\n\n// Store cache results in an outer scoped variable., so all instances share the same data\n// and can build the cache together.\nconst atCache = {};\nconst atEmpty = {};\n\n// The current raw match. This is needed to properly match quoted strings.\nlet rawMatch: string | undefined;\n\n// Set minimum characters to type for @mentions to fire\nconst minCharacters = getMeta(\"mentionMinChars\", 2);\n\n// Max suggestions to show in dropdown.\nconst maxSuggestions = getMeta(\"mentionSuggestionCount\", 5);\n\n// Server response limit. This should match the limit set in\n// *UserController->TagSearch* and UserModel->TagSearch\nconst serverLimit = 30;\n\n// Emoji, set in definition list in foot, by Emoji class. Make sure\n// that class is getting instantiated, otherwise emoji will be empty.\n\ninterface IEmojiData {\n    assetPath?: string;\n    emoji?: {\n        [key: string]: string;\n    };\n    format?: string;\n}\n\nconst emojiData: IEmojiData = getMeta(\"emoji\", {});\nconst emojis = emojiData.emoji || {};\nconst emojiFormat = emojiData.format || \"\";\nconst emojiAssetPath = emojiData.assetPath || \"\";\n\nconst emojiList = Object.entries(emojis).map(([index, emojiImageUrl]) => {\n    const parts = emojiImageUrl.split(\".\");\n\n    return { name: index, filename: emojiImageUrl, basename: parts[0], ext: \".\" + parts[1] };\n});\n\nconst emojiContentTemplate = emojiFormat\n    .replace(/{(.+?)}/g, \"$${$1}\")\n    .replace(\"%1$s\", \"${src}\")\n    .replace(\"%2$s\", \"${name}\")\n    .replace(\"${src}\", emojiAssetPath + \"/${filename}\")\n    .replace(\"${dir}\", emojiAssetPath);\nconst emojiTemplate =\n    '<li data-value=\":${name}:\" class=\"at-suggest-emoji\"><span class=\"emoji-wrap\">' +\n    emojiContentTemplate +\n    '</span> <span class=\"emoji-name\">${name}</span></li>';\n\n/**\n * Match an @mention\n *\n * @param flag - The character sequence used to trigger this match (e.g. :).\n * @param subtext - The string to be tested.\n * @param shouldStartWithSpace - Should the pattern include a test for a whitespace prefix?\n * @returns Matching string if successful. Null on failure to match.\n */\nexport function matchAtMention(flag: string, subtext: string, shouldStartWithSpace: boolean): string | null {\n    const match = _matchAtMention(subtext, shouldStartWithSpace);\n    if (match) {\n        rawMatch = match.rawMatch;\n        return match.match;\n    }\n\n    return null;\n}\n\n/**\n * Custom matching for our emoji images. Eg. :) :/ >:(\n *\n * @param flag - The character sequence used to trigger this match (e.g. :).\n * @param subtext - The string to be tested.\n * @param shouldStartWithSpace - Should the pattern include a test for a whitespace prefix?\n * @returns Matching string if successful.  Null on failure to match.\n */\nexport function matchFakeEmoji(flag, subtext, shouldStartWithSpace) {\n    flag = flag.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n    if (shouldStartWithSpace) {\n        flag = \"(?:^|\\\\s)\" + flag;\n    }\n\n    // Some browsers append a linefeed to the end of subtext.  We need to allow for it.\n    const regexp = new RegExp(flag + \"([A-Za-z0-9_+-]*|[^\\\\x00-\\\\xff]*)(?:\\\\n)?$\", \"gi\");\n    const match = regexp.exec(subtext);\n\n    if (match) {\n        return match[2] || match[1];\n    } else {\n        return null;\n    }\n}\n\nexport function initializeAtComplete(editorElement, iframe?: HTMLIFrameElement) {\n    // Handle iframe situation\n    const iframeWindow = iframe ? iframe.contentWindow : \"\";\n\n    const remoteDataHandler = (query, callback) => {\n        // Do this because of undefined when adding spaces to\n        // matcher callback, as it will be monitoring changes.\n        query = query || \"\";\n\n        // Only all query strings greater than min_characters\n        if (query.length >= minCharacters) {\n            // If the cache array contains less than LIMIT 30\n            // (according to server logic), then there's no\n            // point sending another request to server, as there\n            // won't be any more results, as this is the maximum.\n            let shouldContinueFiltering = true;\n\n            // Remove last character so that the string can be\n            // found in the cache, if exists, then check if its\n            // matching array has less than the server limit of\n            // matches, which means there are no more, so save the\n            // additional server request from being sent.\n            let filterString = \"\";\n\n            // Loop through string and find first closest match in\n            // the cache, and if a match, check if more filtering\n            // is required.\n            for (let i = 0, l = query.length; i < l; i++) {\n                filterString = query.slice(0, -i);\n\n                if (atCache[filterString] && atCache[filterString].length < serverLimit) {\n                    // Add this other query to empty array, so that it\n                    // will not fire off another request.\n                    atEmpty[query] = query;\n\n                    // Do not filter more, meaning, do not send\n                    // another server request, as all the necessary\n                    // data is already in memory.\n                    shouldContinueFiltering = false;\n                    break;\n                }\n            }\n\n            // Check if query would be empty, based on previously\n            // cached empty results. Compare against the start of\n            // the latest query string.\n            let isQueryEmpty = false;\n\n            // Loop through cache of empty query strings.\n            for (const key in atEmpty) {\n                if (atEmpty.hasOwnProperty(key)) {\n                    // See if cached empty results match the start\n                    // of the latest query. If so, then no point\n                    // sending new request, as it will return empty.\n                    if (query.match(new RegExp(\"^\" + key + \"+\")) !== null) {\n                        isQueryEmpty = true;\n                        break;\n                    }\n                }\n            }\n\n            const filterSuccessHandler = data => {\n                if (Array.isArray(data)) {\n                    data.forEach(result => {\n                        if (typeof result === \"object\" && typeof result.name === \"string\") {\n                            // Convert special characters to safely insert into template.\n                            result.name = result.name\n                                .replace(/&/g, \"&amp;\")\n                                .replace(/</g, \"&lt;\")\n                                .replace(/>/g, \"&gt;\")\n                                .replace(/\"/g, \"&quot;\")\n                                .replace(/'/g, \"&apos;\");\n                        }\n                    });\n                }\n\n                callback(data);\n\n                // If data is empty, cache the results to prevent\n                // other requests against similarly-started\n                // query strings.\n                if (data.length) {\n                    atCache[query] = data;\n                } else {\n                    atEmpty[query] = query;\n                }\n            };\n\n            // Produce the suggestions based on data either\n            // cached or retrieved.\n            if (shouldContinueFiltering && !isQueryEmpty && !atCache[query]) {\n                $.getJSON(\n                    formatUrl(\"/user/tagsearch\"),\n                    {\n                        q: query,\n                        limit: serverLimit,\n                    },\n                    filterSuccessHandler,\n                );\n            } else {\n                // If no point filtering more as the parent filter\n                // has not been maxed out with responses, use the\n                // closest parent filter instead of the latest\n                // query string.\n                if (!shouldContinueFiltering) {\n                    callback(atCache[filterString]);\n                } else {\n                    callback(atCache[query]);\n                }\n            }\n        }\n    };\n\n    /**\n     * Pre-insert handler for atwho.\n     *\n     * Note, in contenteditable mode (iframe for us), the value is surrounded by span tags.\n     */\n    function beforeInsertHandler(value: string, $li: JQuery<any>): string {\n        // It's better to use the value provided, as it may have\n        // html tags around it, depending on mode. Using the\n        // regular expression avoids the need to check what mode\n        // the suggestion is made in, and then constructing\n        // it based on that. Optional assignment for undefined\n        // matcher callback results.\n        let username = $li.data(\"value\") || \"\";\n        // Pop off the flag--usually @ or :\n        username = username.slice(1, username.length);\n\n        // Check if there are any whitespaces, and if so, add\n        // quotation marks around the whole name.\n        const requiresQuotation = /[^\\w-]/.test(username);\n\n        // Check if there are already quotation marks around\n        // the string--double or single.\n        const hasQuotation = /([\"'])(.+)([\"'])/g.test(username);\n\n        let insert = username;\n        if (requiresQuotation && !hasQuotation) {\n            // Do not even need to have value wrapped in\n            // any tags at all. It will be done automatically.\n            // insert = value.replace(/(.*\\>?)@([\\w\\d\\s\\-\\+\\_]+)(\\<?.*)/, '$1@\"$2\"$3');\n            insert = '\"' + username + '\"';\n        }\n\n        // This is needed for checking quotation mark directly\n        // after at character, and preventing another at character\n        // from being inserted into the page.\n        const rawAtMatch = rawMatch || \"\";\n\n        const atQuote = /.?@([\"'])/.test(rawAtMatch);\n\n        // If atQuote is false, then insert the at character,\n        // otherwise it means the user typed a quotation mark\n        // directly after the at character, which, would get\n        // inserted again if not checked. atQuote would\n        // be false most of the time; the exception is when\n        // it's true.\n        if (!atQuote) {\n            insert = this.at + insert;\n        }\n\n        // The last character prevents the matcher from trigger on nearly everything.\n        return insert;\n    }\n\n    /**\n     * Custom highlighting to accept spaces in names.\n     * This is almost a copy of the default in the library, with tweaks in the regex.\n     */\n    function highlightHandler(li: string, query: string): string {\n        if (!query) {\n            return li;\n        }\n        const regexp = new RegExp(\">\\\\s*(\\\\w*)(\" + query.replace(\"+\", \"\\\\+\") + \")(\\\\w*)\\\\s*(\\\\s+.+)?<\", \"ig\");\n        // Capture group 4 for possible spaces\n        return li.replace(regexp, (str, $1, $2, $3, $4) => {\n            // Weird Chrome behaviour, so check for undefined, then\n            // set to empty string if so.\n            if (typeof $3 === \"undefined\") {\n                $3 = \"\";\n            }\n            if (typeof $4 === \"undefined\") {\n                $4 = \"\";\n            }\n\n            return \"> \" + $1 + \"<strong>\" + $2 + \"</strong>\" + $3 + $4 + \" <\";\n        });\n    }\n\n    $(editorElement)\n        .atwho({\n            at: \"@\",\n            tpl: '<li data-value=\"@${name}\" data-id=\"${id}\">${name}</li>',\n            limit: maxSuggestions,\n            callbacks: {\n                remote_filter: remoteDataHandler,\n                before_insert: beforeInsertHandler,\n                highlighter: highlightHandler,\n                matcher: matchAtMention,\n            },\n            cWindow: iframeWindow,\n        })\n        .atwho({\n            at: \":\",\n            tpl: emojiTemplate,\n            insert_tpl: \"${atwho-data-value}\",\n            callbacks: {\n                matcher: matchFakeEmoji,\n                tplEval: (tpl, map) => log(map),\n            },\n            limit: maxSuggestions,\n            data: emojiList,\n            cWindow: iframeWindow,\n        });\n\n    /**\n     * This hook is triggered when atWho places a selection list in the window.\n     * The context is passed implicitly when triggered by at.js.\n     *\n     * @param event - A custom event triggered by the advanced editor iframe/wysiwyg.\n     * @param offset - The pixel offsets inside of the iframe.\n     * @param context - Context from the contenteditable inside of the iframe.\n     */\n    function iframeAtWhoRepositionHandler(event: any, offset: any, context: any) {\n        // Actual suggestion box that will appear.\n        const suggestionElement = context.view.$el;\n\n        // The area where text will be typed (contenteditable body).\n        const $inputor = context.$inputor;\n\n        // Display it below the text.\n        const lineHeight = parseInt($inputor.css(\"line-height\"), 10);\n\n        // offset contains the top left values of the offset to the iframe\n        // we need to convert that to main window coordinates\n        const iframeOffset = $(iframe).offset();\n        let leftCoordinate = (iframeOffset ? iframeOffset.left : 0) + offset.left;\n        let topCoordinate = iframeOffset ? iframeOffset.top : 0;\n        let selectHeight = 0;\n\n        // In wysiwyg mode, the suggestbox follows the typing, which\n        // does not happen in regular mode, so adjust it.\n        // Either @ or : for now.\n        const at = context.at;\n        const { text } = context.query;\n        const fontMirror = $(\".BodyBox,.js-bodybox\");\n        const font = fontMirror.css(\"font-size\") + \" \" + fontMirror.css(\"font-family\");\n\n        // Get font width\n        const fontWidth = (at + text).width(font) - 2;\n\n        if (at === \"@\") {\n            leftCoordinate -= fontWidth;\n        }\n\n        if (at === \":\") {\n            leftCoordinate -= 2;\n        }\n\n        // atWho adds 3 select areas, presumably for differnet positing on screen (above below etc)\n        // This finds the active one and gets the container height\n        $(suggestionElement).each((index, element) => {\n            const outerHeight = $(element).outerHeight();\n            const height = $(element).height();\n\n            if (outerHeight && height && outerHeight > 0) {\n                selectHeight += height + lineHeight;\n            }\n        });\n\n        // Now should we show the selection box above or below?\n        const windowHeight = $(window).height() || 0;\n        const scrollPosition = $(window).scrollTop() || 0;\n        const selectionPosition = topCoordinate + offset.top - ($(window).scrollTop() || 0);\n        const iAvailableSpace = windowHeight - (selectionPosition - scrollPosition);\n\n        if (iAvailableSpace >= selectHeight) {\n            // Enough space below\n            topCoordinate = topCoordinate + offset.top + selectHeight - scrollPosition;\n        } else {\n            // Place it above instead\n            // @todo should check if this is more space than below\n            topCoordinate = topCoordinate + offset.top - scrollPosition;\n        }\n\n        // Move the select box\n        const newOffset = {\n            left: leftCoordinate,\n            top: topCoordinate,\n        };\n        $(suggestionElement).offset(newOffset);\n    }\n\n    // Only necessary for iframe.\n    // Based on work here: https://github.com/ichord/At.js/issues/124\n    if (iframeWindow) {\n        $(iframeWindow).on(\"reposition.atwho\", iframeAtWhoRepositionHandler);\n    }\n}\n","import React from \"react\";\nimport { getRoutes, getMeta } from \"@core/application\";\nimport { BrowserRouter as Router, Route, RouteProps, Switch } from \"react-router-dom\";\nimport NotFoundPage from \"@core/Main/NotFoundPage\";\n\n/**\n * The root application component.\n *\n * This component renders the top-level pages that have been registered with {@link module:application.addRoutes}.\n */\nexport default class App extends React.PureComponent {\n    public render() {\n        const routes = getRoutes().map((route: React.ReactElement<RouteProps>) => {\n            return <route.type key={route.key || route.props.path + (route.props.exact ? \"!\" : \"\")} {...route.props} />;\n        });\n\n        routes.push(<Route key=\"@not-found\" component={NotFoundPage} />);\n\n        return (\n            <Router basename={getMeta(\"context.basePath\", \"\")}>\n                <Switch>{routes}</Switch>\n            </Router>\n        );\n    }\n}\n","/**\n * Entrypoint for gradually replacing global.js\n *\n * At some point everything in this folder should be able to be removed (new base theme).\n *\n * @author Adam Charron <adam.c@vanillaforums.com>\n * @copyright 2009-2018 Vanilla Forums Inc.\n * @license GPLv2\n */\n\nimport { onContent, onReady } from \"@core/application\";\nimport { initializeAtComplete } from \"@core/legacy/atwho\";\n\n// Initialize legacy @mentions for all BodyBox elements.\nif ($.fn.atwho) {\n    onReady(() => initializeAtComplete(\".BodyBox,.js-bodybox\"));\n    onContent(() => initializeAtComplete(\".BodyBox,.js-bodybox\"));\n\n    // Also assign this function to the global `gdn` object.\n    // The advanced editor calls this function directly when in wysiwyg format, as it needs to\n    // handle an iframe, and the editor instance needs to be referenced. The advanced editor does not yet use\n    // this build process so it can only communicate through here with a global.\n    window.gdn.atCompleteInit = initializeAtComplete;\n}\n","/**\n * @author Adam Charron <adam.c@vanillaforums.com>\n * @copyright 2009-2018 Vanilla Forums Inc.\n * @license GPLv2\n */\n\nimport { onContent, getMeta, _executeReady } from \"@core/application\";\nimport { log, logError, debug } from \"@core/utility\";\nimport { _mountComponents } from \"@core/internal\";\nimport gdn from \"@core/gdn\";\nimport apiv2 from \"@core/apiv2\";\n\n// Right now this is imported here instead of being its own bundle.\n// Once we have some part of vanilla that can function without the legacy js,\n// this should be pulled out into its own javascript bundle.\nimport \"@core/legacy\";\n\n// Inject the debug flag into the utility.\ndebug(getMeta(\"debug\", false));\n\n// Export the API to the global object.\ngdn.apiv2 = apiv2;\n\n// Mount all data-react components.\nonContent(e => {\n    _mountComponents(e.target);\n});\n\nlog(\"Bootstrapping\");\n_executeReady()\n    .then(() => {\n        log(\"Bootstrapping complete.\");\n\n        const contentEvent = new CustomEvent(\"X-DOMContentReady\", { bubbles: true, cancelable: false });\n        document.dispatchEvent(contentEvent);\n    })\n    .catch(error => {\n        logError(error);\n    });\n","/**\n * Internal functions that should not be used outside of core.\n *\n * @module internal\n */\n\nimport { addComponent, componentExists, getComponent } from \"@core/application\";\nimport App from \"@core/Main/App\";\nimport { logError } from \"@core/utility\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\n\n/**\n * Mount all declared Components on the dom.\n *\n * The page signifies that an element contains a component with the `data-react=\"<Component>\"` attribute.\n *\n * @param parent - The parent element to search. This element is not included in the search.\n */\nexport function _mountComponents(parent: Element) {\n    if (!componentExists(\"App\")) {\n        addComponent(\"App\", App);\n    }\n\n    const nodes = parent.querySelectorAll(\"[data-react]\");\n\n    Array.prototype.forEach.call(nodes, node => {\n        const name = node.getAttribute(\"data-react\");\n        const Component = getComponent(name);\n\n        if (Component) {\n            ReactDOM.render(<Component />, node);\n        } else {\n            logError(\"Could not find component %s.\", name);\n        }\n    });\n}\n"],"sourceRoot":""}