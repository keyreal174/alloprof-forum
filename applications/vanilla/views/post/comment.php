<?php if (!defined('APPLICATION')) exit();
$dataDriven = \Gdn::themeFeatures()->useDataDrivenTheme();
if (Gdn::session()->isValid()) {
    $User = Gdn::session()->User;
}
// if (!$User) {
//     return;
// }

$IsProfilePage = val('IsProfilePage', Gdn::controller());
$UserMetaData = Gdn::userModel()->getMeta($User->UserID, 'Profile.%', 'Profile.');

$Session = Gdn::session();
$NewOrDraft = !isset($this->Comment) || property_exists($this->Comment, 'DraftID') ? true : false;
$Editing = isset($this->Comment);
$formCssClass = 'BoxButtons BoxNewDiscussion MessageForm CommentPostForm FormTitleWrapper';
if ($this->UserRole == TEACHER_ROLE) {
    $formCssClass = $formCssClass . " InlineFormatterEnabled";
}
$this->EventArguments['FormCssClass'] = &$formCssClass;
$this->fireEvent('BeforeCommentForm');
?>
<div class="<?php echo $formCssClass; ?>">
    <?php
        if ($Editing) {
            ?>
            <h2 class="H"><?php echo t('Edit Comment'); ?></h2>
            <?php
        } else {
            $Photo = $User->Photo ? url($User->Photo) : UserModel::getDefaultAvatarUrl($User, 'profile');
            $UserName = $UserMetaData["DisplayName"] ?? "";
            echo '<div class="UserInfo">';
            // echo "<a class='UserPhoto' href='".url("/profile/picture?userid=".$User->UserID)."'><img src='".$Photo."' class='PhotoWrap' alt='Photo'/></a>";
            echo '<span style="margin-right: 8px; height: 44px;">';
            echo userPhoto($User);
            echo '</span>';
            echo '<div class="UserAuthor">';
            if ($this->UserRole == TEACHER_ROLE) {
                echo '<span class="UserAuthorName">'.$UserName.'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M8.64495 0.776516C9.40048 0.0744949 10.5995 0.0744944 11.3551 0.776516L12.0133 1.38817C12.4454 1.78962 13.0461 1.9771 13.6413 1.89624L14.5482 1.77303C15.589 1.63163 16.5591 2.30857 16.7407 3.30306L16.8989 4.16953C17.0028 4.73822 17.3741 5.22906 17.9051 5.49967L18.7142 5.91197C19.6428 6.3852 20.0133 7.4805 19.5516 8.3876L19.1494 9.17793C18.8854 9.69665 18.8854 10.3034 19.1494 10.8221L19.5516 11.6124C20.0133 12.5195 19.6428 13.6148 18.7142 14.088L17.9051 14.5003C17.3741 14.7709 17.0028 15.2618 16.8989 15.8305L16.7407 16.6969C16.5591 17.6914 15.589 18.3684 14.5482 18.227L13.6413 18.1038C13.0461 18.0229 12.4454 18.2104 12.0133 18.6118L11.3551 19.2235C10.5995 19.9255 9.40048 19.9255 8.64495 19.2235L7.98668 18.6118C7.55463 18.2104 6.95389 18.0229 6.35868 18.1038L5.45182 18.227C4.41097 18.3684 3.44092 17.6914 3.2593 16.6969L3.10106 15.8305C2.9972 15.2618 2.62591 14.7709 2.0949 14.5003L1.28584 14.088C0.357241 13.6148 -0.0132854 12.5195 0.44837 11.6124L0.850598 10.8221C1.11459 10.3034 1.11459 9.69665 0.850598 9.17793L0.448371 8.3876C-0.0132849 7.4805 0.357241 6.3852 1.28584 5.91197L2.0949 5.49967C2.62591 5.22906 2.9972 4.73822 3.10106 4.16953L3.2593 3.30306C3.44092 2.30857 4.41097 1.63163 5.45182 1.77303L6.35868 1.89624C6.95388 1.9771 7.55463 1.78962 7.98668 1.38817L8.64495 0.776516Z" fill="#05BF8E"/>
                <path d="M6.25 10L8.75 12.25L13.75 7.75" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                </span>';
            } else {
                echo '<span class="UserAuthorName">'.$UserName.'</span>';
            }
            if ($this->UserRole == TEACHER_ROLE) {
                echo '<span class="UserAuthorGrade">'.t('Teacher').'</span>';
            } else {
                $grade = t($UserMetaData["Grade"]);
                echo '<span class="UserAuthorGrade">'.$grade.'</span>';
            }
            echo '</div>';

            echo '</div>';
        }
    ?>
    <div class="close-icon">
        <img src="<?= url('/themes/alloprof/design/images/icons/close.svg') ?>" />
    </div>
    <div class="CommentFormWrap">
        <?php
            // if (Gdn::session()->isValid()) :
        ?>
            <div class="Form-HeaderWrap">
                <div class="Form-Header">
                    <span class="Author">
                        <?php writeCommentFormHeader(); ?>
                    </span>
                </div>
            </div>
        <?php
            // endif;
        ?>
        <div class="Form-BodyWrap">
            <div class="Form-Body">
                <div class="FormWrapper FormWrapper-Condensed">
                    <?php
                    echo $this->Form->open(['id' => 'Form_Comment']);
                    echo $this->Form->errors();
                    $this->fireEvent('BeforeBodyField');

                    echo $this->Form->bodyBox('Body', ['Table' => 'Comment', 'FileUpload' => true, 'placeholder' => t('Type your comment'), 'title' => t('Type your comment')]);
                    $this->fireEvent('AfterBodyField');
                    echo '<div class="CommentOptions List Inline">';
                    echo '</div>';

                    echo "<div class=\"Buttons\">\n";
                    $this->fireEvent('BeforeFormButtons');

                    $ButtonOptions = ['class' => 'btn-default btn-shadow btn-m-l-auto'];

                    if ($Session->isValid()) {
                        echo $this->Form->button($Editing ? t('Save Comment') : t('Submit my answer'), $ButtonOptions);
                    } else {
                        echo anchor(t('Submit my answer'), '/entry/signinstudent?Target=discussions', 'btn-default btn-shadow SignInStudentPopupAgent SaveComment');
                        echo anchor(t('Submit my answer'), '/entry/signinstudent?Target=discussions', 'btn-default btn-shadow SignInStudentPopup SaveComment HiddenImportant');
                    }

                    $this->fireEvent('AfterFormButtons');
                    echo "</div>\n";
                    echo $this->Form->close();
                    ?>
                </div>
            </div>
        </div>
    </div>
</div>

<?php if ($this->UserRole == "member") { ?>

<div class="information-block newcomment">
    <div>
        <div class="img-box">
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0)">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M56.1207 25.7508C55.9299 21.4319 52.4381 17.9434 48.118 17.757C47.7407 13.4902 44.1352 10.1138 39.7741 10.1138H24.5864C20.7639 10.1138 17.5251 12.7107 16.5282 16.2247C16.5282 16.2247 7.69771 24.9486 7.70769 25.1184C2.4173 26.4793 -0.902516 32.8898 3.31493 38.8642C4.55265 40.6162 6.612 41.6098 8.75734 41.6098H23.2749C25.2149 44.5147 28.5214 46.4398 32.2568 46.4398H41.7469L45.0828 52.8536H50.8098L49.2692 46.4398H51.4156C57.0111 46.4398 61.9742 42.356 62.5573 36.7899C63.0688 31.9011 60.2605 27.565 56.1207 25.7508Z" fill="#FF55C3"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M45.9221 51.4665H49.0478L47.5071 45.0526H51.4128C56.3936 45.0526 60.6815 41.36 61.1753 36.6455C61.6047 32.5479 59.3484 28.6805 55.562 27.0211L54.7709 26.6744L54.7326 25.8123C54.5745 22.2267 51.6419 19.2975 48.0564 19.1427L46.8414 19.0905L46.7343 17.8794C46.4181 14.3028 43.3596 11.5011 39.7718 11.5011H24.5841C21.4773 11.5011 18.7123 13.5993 17.8602 16.6035L17.7603 16.9546L17.5007 17.2115C14.7223 19.956 10.3556 24.3022 9.12457 25.6015L9.15897 26.1768L8.05107 26.4619C5.81419 27.0372 4.00338 28.6755 3.20671 30.843C2.35512 33.1615 2.79507 35.7257 4.44554 38.0646C5.40032 39.4155 7.01141 40.2227 8.75508 40.2227H24.0144L24.426 40.8396C26.188 43.4782 29.1145 45.0526 32.2545 45.0526H42.5862L45.9221 51.4665ZM52.5658 54.2402H44.2368L40.9009 47.8264H32.253C28.4355 47.8264 24.865 46.0344 22.5571 42.9965H8.75354C6.11 42.9965 3.65232 41.7504 2.17827 39.6644C-0.0142308 36.5582 -0.57456 33.0858 0.601577 29.8864C1.66509 26.991 4.02624 24.7735 6.96381 23.8853C7.88641 22.8113 10.09 20.6316 15.3005 15.4843C16.6037 11.4871 20.3673 8.72705 24.5826 8.72705H39.7703C44.3922 8.72705 48.3849 12.0552 49.3247 16.4907C53.5205 17.1836 56.8614 20.606 57.4273 24.8412C61.8672 27.1519 64.4586 31.9091 63.9327 36.9349C63.2925 43.0419 57.7929 47.8264 51.4113 47.8264H51.0251L52.5658 54.2402Z" fill="black"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M22.8426 16.1567H15.7741C11.1639 16.1567 7.39246 19.9281 7.39246 24.5378C7.39246 29.1481 11.1639 32.9195 15.7741 32.9195H25.4001H29.5055C32.4636 32.9195 34.8614 35.3172 34.8614 38.2748" fill="#FF55C3"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M49.5039 23.8962H46.73C46.73 20.3938 43.8801 17.5439 40.3777 17.5439C36.8748 17.5439 34.0255 20.3938 34.0255 23.8962H31.2516C31.2516 18.8643 35.3453 14.77 40.3777 14.77C45.4096 14.77 49.5039 18.8643 49.5039 23.8962ZM44.5242 39.4882H41.7503C41.7503 34.4563 45.8446 30.362 50.8765 30.362H55.8629V33.1359H50.8765C47.3741 33.1359 44.5242 35.9858 44.5242 39.4882ZM45.3871 47.1646H48.1755C52.5788 47.1646 54.6298 45.0742 54.6298 40.5877V38.0485H51.8559V40.5877C51.8559 43.5375 51.0304 44.3907 48.1755 44.3907H45.3871V47.1646ZM33.4649 32.821H34.4283C38.5081 32.821 41.828 29.5017 41.828 25.4218V23.8962H39.054V25.4218C39.054 27.9722 36.9792 30.0471 34.4283 30.0471H29.2838V31.5331H15.774C11.9171 31.5331 8.77928 28.3953 8.77928 24.5384C8.77928 20.6816 11.9171 17.5443 15.774 17.5443H22.8424V14.7704H15.774C10.3876 14.7704 6.00537 19.152 6.00537 24.5384C6.00537 29.5616 9.81661 33.7116 14.6992 34.2483V34.3067C16.6077 34.3067 18.1605 35.8595 18.1605 37.768H20.9344C20.9344 36.4885 20.547 35.2978 19.8834 34.307H29.5054C31.694 34.307 33.4743 36.0873 33.4743 38.2754H36.2482C36.2482 36.0359 35.1505 34.0478 33.4649 32.821ZM20.2166 28.7261C17.3029 28.7261 14.9329 26.3561 14.9329 23.4429H17.7068C17.7068 24.8266 18.8324 25.9522 20.2166 25.9522V28.7261Z" fill="black"/>
            </g>
            <defs>
            <clipPath id="clip0">
            <rect width="64" height="64" fill="white"/>
            </clipPath>
            </defs>
            </svg>
        </div>
        <p><?php echo t('Explain your methodology so the student progresses') ?></p>
    </div>
    <div>
        <div class="img-box">
            <svg width="64" height="57" viewBox="0 0 64 57" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2.57143 0.363525C1.15127 0.363525 0 1.51479 0 2.93495V46.0984C0 47.5186 1.15127 48.6698 2.57143 48.6698L23.6434 48.6698C23.8716 48.6698 24.0905 48.7609 24.2514 48.9228L31.392 56.109C31.7272 56.4463 32.2728 56.4463 32.608 56.109L39.7486 48.9228C39.9095 48.7609 40.1284 48.6698 40.3566 48.6698L61.4286 48.6698C62.8487 48.6698 64 47.5186 64 46.0984V2.93495C64 1.51479 62.8487 0.363525 61.4286 0.363525H2.57143Z" fill="#FF7575"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M2.90909 3.27262V45.7608L23.6434 45.7607C24.6464 45.7607 25.608 46.1608 26.3149 46.8723L32 52.5937L37.6851 46.8723C38.392 46.1608 39.3536 45.7607 40.3566 45.7607L61.0909 45.7608V3.27262H2.90909ZM0 2.93495C0 1.51479 1.15127 0.363525 2.57143 0.363525H61.4286C62.8487 0.363525 64 1.51479 64 2.93495V46.0984C64 47.5186 62.8487 48.6698 61.4286 48.6698L40.3566 48.6698C40.1284 48.6698 39.9095 48.7609 39.7486 48.9228L32.608 56.109C32.2728 56.4463 31.7272 56.4463 31.392 56.109L24.2514 48.9228C24.0905 48.7609 23.8716 48.6698 23.6434 48.6698L2.57143 48.6698C1.15127 48.6698 0 47.5186 0 46.0984V2.93495Z" fill="black"/>
            <path d="M14.6401 22.3635L14.1241 20.7555L12.0601 21.5835L12.2161 19.3635H10.5241L10.6801 21.5835L8.60413 20.7555L8.08813 22.3635L10.2241 22.9035L8.80813 24.6075L10.1761 25.6035L11.3641 23.7075L12.5521 25.6035L13.9201 24.6075L12.4921 22.9035L14.6401 22.3635Z" fill="black"/>
            <path d="M21.7379 22.6755V23.0355C21.4619 22.6635 21.1019 22.4835 20.5859 22.4835C19.4339 22.4835 18.5819 23.4075 18.5819 24.7035C18.5819 26.0115 19.4339 26.9355 20.6459 26.9355C21.3899 26.9355 21.9659 26.5395 22.2179 25.9155C22.4579 26.3715 22.9859 26.6715 23.6819 26.6715C25.0259 26.6715 25.9139 25.5435 25.9139 23.9595C25.9139 21.5715 23.9699 19.8435 21.2099 19.8435C18.2219 19.8435 16.1459 21.8355 16.1459 24.7035C16.1459 27.5595 18.1859 29.5515 21.1499 29.5515C22.3139 29.5515 23.3699 29.2515 24.3419 28.5915L23.6699 27.2715C22.7339 27.8355 21.9059 28.0755 21.0779 28.0755C19.0619 28.0755 17.7299 26.7195 17.7299 24.7155C17.7299 22.6875 19.0979 21.3075 21.1979 21.3075C23.0579 21.3075 24.4019 22.3995 24.4019 24.1155C24.4019 24.8235 24.1739 25.3035 23.7419 25.3035C23.3579 25.3035 23.2739 24.9315 23.2739 24.6915V22.6755H21.7379ZM21.0419 25.4955C20.5259 25.4955 20.2139 25.1595 20.2139 24.7035C20.2139 24.2475 20.5259 23.9235 21.0179 23.9235C21.3419 23.9235 21.5939 24.0435 21.7379 24.2595V25.1715C21.5939 25.3755 21.3419 25.4955 21.0419 25.4955Z" fill="black"/>
            <path d="M36.4213 23.2875L36.4813 21.8115H34.6453L34.7053 19.9635H33.2053L33.1453 21.8115H31.2133L31.2733 19.9635H29.7853L29.7253 21.8115H27.9253L27.8653 23.2875H29.6773L29.6053 25.0395H27.7813L27.7333 26.5035H29.5573L29.4973 28.3635H30.9853L31.0453 26.5035H32.9773L32.9173 28.3635H34.4173L34.4773 26.5035H36.2893L36.3493 25.0395H34.5253L34.5973 23.2875H36.4213ZM33.0253 25.0395H31.0933L31.1653 23.2875H33.0973L33.0253 25.0395Z" fill="black"/>
            <path d="M40.9837 19.8435C39.7357 19.8435 38.7157 20.2995 38.1037 21.0315L39.2437 22.1835C39.7357 21.6915 40.3117 21.4395 40.8397 21.4395C41.4517 21.4395 41.8357 21.7155 41.8357 22.1595C41.8357 22.7595 41.1757 23.0595 39.9877 23.0715V25.0875H41.7517L41.7757 24.0435C42.9757 23.6835 43.6957 22.9515 43.6957 21.9195C43.6957 20.6595 42.6157 19.8435 40.9837 19.8435ZM40.8397 26.0595C40.0837 26.0595 39.5197 26.5755 39.5197 27.2715C39.5197 27.9555 40.0837 28.4835 40.8397 28.4835C41.5837 28.4835 42.1357 27.9555 42.1357 27.2715C42.1357 26.5755 41.5837 26.0595 40.8397 26.0595Z" fill="black"/>
            <path d="M47.734 19.9635H45.946L45.958 25.0995H47.722L47.734 19.9635ZM46.858 26.0595C46.102 26.0595 45.538 26.5755 45.538 27.2715C45.538 27.9555 46.102 28.4835 46.858 28.4835C47.602 28.4835 48.154 27.9555 48.154 27.2715C48.154 26.5755 47.602 26.0595 46.858 26.0595Z" fill="black"/>
            <path d="M52.7499 19.8435C51.5019 19.8435 50.4819 20.2995 49.8699 21.0315L51.0099 22.1835C51.5019 21.6915 52.0779 21.4395 52.6059 21.4395C53.2179 21.4395 53.6019 21.7155 53.6019 22.1595C53.6019 22.7595 52.9419 23.0595 51.7539 23.0715V25.0875H53.5179L53.5419 24.0435C54.7419 23.6835 55.4619 22.9515 55.4619 21.9195C55.4619 20.6595 54.3819 19.8435 52.7499 19.8435ZM52.6059 26.0595C51.8499 26.0595 51.2859 26.5755 51.2859 27.2715C51.2859 27.9555 51.8499 28.4835 52.6059 28.4835C53.3499 28.4835 53.9019 27.9555 53.9019 27.2715C53.9019 26.5755 53.3499 26.0595 52.6059 26.0595Z" fill="black"/>
            </svg>
        </div>
        <p><?php echo t('Do not publish anything offensive.') ?></p>
    </div>
    <div>
        <div class="img-box">
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M16.2174 39.6789H19.6664V45.5301L29.6292 39.6789H47.7821C50.53 39.6789 52.7568 37.452 52.7568 34.7041V23.2179C52.7568 20.47 50.53 18.2432 47.7821 18.2432H16.2174C13.4706 18.2432 11.2427 20.47 11.2427 23.2179V34.7041C11.2427 37.452 13.4706 39.6789 16.2174 39.6789Z" fill="#EEF05D"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M47.7822 19.486C49.84 19.486 51.514 21.16 51.514 23.2178V34.7041C51.514 36.7619 49.84 38.4358 47.7822 38.4358H29.2912L20.9094 43.3589V38.4358H16.2175C14.1597 38.4358 12.4857 36.7619 12.4857 34.7041V23.2178C12.4857 21.16 14.1597 19.486 16.2175 19.486H47.7822ZM18.4236 47.7011L29.9671 40.9216H47.7823C51.2108 40.9216 54 38.1324 54 34.7039V23.2177C54 19.7892 51.2108 17 47.7823 17H16.2177C12.7892 17 10 19.7892 10 23.2177V34.7039C10 38.1324 12.7892 40.9216 16.2177 40.9216H18.4236V47.7011Z" fill="black"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M30.7186 30.3343H33.0588L33.0742 23.5225H30.7032L30.7186 30.3343ZM30.146 33.2155C30.146 34.1224 30.8778 34.8224 31.8647 34.8224C32.8665 34.8224 33.6143 34.1224 33.6143 33.2155C33.6143 32.2923 32.8665 31.6077 31.8647 31.6077C30.8778 31.6077 30.146 32.2923 30.146 33.2155Z" fill="black"/>
            </svg>
        </div>
        <p><?php echo t('Don\'t give the answer, but an explanation!') ?></p>
    </div>
</div>

<?php } ?>